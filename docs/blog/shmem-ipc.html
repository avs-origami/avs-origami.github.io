<!doctype html>
<html lang=en>
<head>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    <link rel="stylesheet" type="text/css" href="/style.css">
</head>
<title>AVS Origami - blog/shmem-ipc</title>
<meta charset=utf-8>
<meta name=Description content="A personal website">
<meta name=viewport content="width=device-width,initial-scale=1">
<a id="top"></a>

<!-- Flex container. -->
<div class="container blur">

<!-- The top banner with navigation links. -->
<div class="banner"><div class=t><pre style="text-align:center;">

<table style="font-weight:600;margin:0 auto;"><tr>
    <td><a href=/><img src="/img/home.png"></img></a></td>
    <td><a href=/ style="color:#cb4b16">HOME</a></td>
    <td><a href=/projects>PROJECTS</a></td>
    <td><a href=/blog>BLOG</a></td>
    <td><a href=/origami>ORIGAMI</a></td>
    <td><a href=/bonsai>BONSAI</a></td>
    <td><a href=/music>MUSIC</a></td>
    <td><a href=/projects/tincan.html>TIN CAN LINUX</a></td>
    <td><a href=/wikis>WIKIS</a></td>
    <td><a href=https://github.com/avs-origami target="_blank" rel="noopener noreferrer">GITHUB</a></td>
    <td><a href=https://github.com/avs-origami target="_blank" rel="noopener noreferrer"><img src="/img/octo.png"></img></a></td>
</tr></table>
</pre></div></div>

<!-- Main body table div. -->
<div style="display:table;margin:16px auto;min-height:100%;position:relative;top:128px;">

<!-- The left column with picture and quick info. -->
<div class=p style="padding-right:6ch"><pre class=prebox style="text-align:center;">

<img src="/img/me.jpg" class=pfp>

<b>Adithya V. Sastry</b>

Robotics + Origami
Creator of <a href=/projects/tincan.html>Tin Can Linux</a>
Lover of all things tiny


<i>"A dream is not that which you see while
sleeping, it is that which does not let
you sleep."</i>

-- Dr. APJ Abdul Kalam

</pre></div>

<!-- The main body text. -->
<div class=c><pre class=prebox>
<b>Shared Memory IPC in Rust                                             06/23/2024
--------------------------------------------------------------------------------</b>

I recently came across <a href="https://crates.io/crates/shmem-ipc" target="_blank" rel="noopener noreferrer">an interesting crate for Rust</a> that enables interprocess
communication via shared memory. At the time I was looking for a faster method
of transferring large amounts of data between different processes, and this
crate proved to be an effective solution.

PSA: this involves the use of unsafe Rust. Yipee!


<b>Initial Setup
-------------</b>

Besides just this crate, you need a few other things to make this work. There
needs to be a way to transfer file descriptors between the two programs. The
examples provided in the repository use DBUS to achieve this, but this is
honestly overkill. Instead, we use good ol' Unix Sockets along with <a href="https://crates.io/crates/passfd" target="_blank" rel="noopener noreferrer">a nifty</a>
<a href="https://crates.io/crates/passfd" target="_blank" rel="noopener noreferrer">crate called passfd</a> to transfer the file descriptors and set up the shared
memory pipeline.

Start by creating a new project the usual way:

--------------------------------------------------------------------------------

  $ cargo new shmem-test
  $ cd shmem-test

--------------------------------------------------------------------------------


You will also need to modify Cargo.toml to include the two crates previously
mentioned and create separate client and server binaries:

--------------------------------------------------------------------------------

  [package]
    name = "shmem-test"
    version = "0.1.0"
    edition = "2021"

    # See more keys and their definitions at <a href=https://doc.rust-lang.org/cargo/refere>>https://doc.rust-lang.org/cargo/refere></a>

    [dependencies]
    anyhow = "1.0"
    shmem-ipc = "0.3.0"
    passfd = "0.1.6"

    [[bin]]
    name = "client"
    path = "src/client.rs"

    [[bin]]
    name = "server"
    path = "src/server.rs"

--------------------------------------------------------------------------------


<b>Basic Server-Client Interaction
-------------------------------</b>

Let's modify the example from the shmem-ipc repo to use sockets and passfd
instead of dbus.

Starting with server.rs:

--------------------------------------------------------------------------------



--------------------------------------------------------------------------------
</pre></div>

<!-- Invisible right column so that the body is centered. -->
<div class=p style="padding-left:6ch;"><pre class=prebox>
<div class=ctr>==============   Updates   ==============</div>

<em>News - 12/01/2024</em>
<a href=https://github.com/avs-origami/arc/releases/tag/v0.0.4 target="_blank" rel="noopener noreferrer">Arc: first release candidate</a>


<em>News - 11/28/2024</em>
<a href=https://github.com/tincan-linux target="_blank" rel="noopener noreferrer">Tin Can: 16 followers + 11 stars on GitHub</a>


<em>Post - 11/19/2024</em>
<a href=/blog/torch-rust-cxx.html>LibTorch in Rust using FFIs</a>


<em>News - 11/07/2024</em>
<a href=https://github.com/avs-origami/arc target="_blank" rel="noopener noreferrer">Arc: rusty package manager for Linux</a>


<em>Post - 06/23/2024</em>
<a href=/blog/shmem-ipc.html>Shared Memory IPC in Rust</a>


<em>Post - 01/14/2024</em>
<a href=/blog/install-kiss.html>Installing Kiss Linux</a>

</pre></div>

<!-- End main body table div. -->
</div>

<!-- Fill remaining space if any left. -->
<main></main>

<!-- Footer. -->
<footer><div class=footer>

<!-- Left spacer. -->
<div class=t></div>

<!-- Left side footer text. -->
<div class=tt><pre>

AVS Origami (C) 2023-2024

</pre></div>

<!-- Right side footer text. -->
<div class=tt style="text-align:right;"><pre style="text-align:right;">

<a href="#top">Back to top</a>

</pre></div>

<!-- Right spacer. -->
<div class=t></div>

<!-- End footer. -->
</div></footer>

<!-- End container. -->
</div>